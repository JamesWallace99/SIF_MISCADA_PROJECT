# Example Data Extraction Workflow

The 'tif_fluorescence_conversion.py' script contains functions for extracting the SIF at the O$_2$ absorption bands from a hyperspectral TIF image file. The primary function 'get_tif_fluorescence' takes in a TIF image, a specified Fraunhofer Line Depth method, a simulated irradiance dataset from Py6S and a csv containing the the sampling wavelengths. It generates a csv file containing the parameters used within the function, a csv containing the retrieved fluorescence values at each coordinate and plots showing a heatmap of the fluorescence values across the image area and a histogram of the distribution of the retrieved SIF.

# Basic Usage


```python
# import all functions from the extraction script
from tif_fluorescence_conversion import *
```

The primary function 'get_tif_fluorescence' performs all of the conversion methods and then applies a pre-defined FLD method to extract the SIF from each co-ordinate within a TIF image. It requires four input arguments.


```python
# input arguments for extraction method

# pathname for the target TIF image
tif_pathname = '/Users/jameswallace/Desktop/Project/data/red/s21_6562_E.tif'

# FLD method for extraction ('standard', 'three' or 'improved')
method = 'three'

# pathname for the Py6S irradaince output csv
e_pathname = '/Users/jameswallace/Desktop/SIF_MISCADA_PROJECT/py6s_generate_irradiance/17_06_2021_13:18_irradiance.csv'

# pathname for the csv containing the measurement wavelengths
bandnumber_pathname = '/Users/jameswallace/Desktop/Project/band_number_conversion.csv'
```

The 'get_tif_fluorescence' function also takes two optional arguments.


```python
# optional arguments for extraction method

# plot determines whether to generate the heatmap and histogram of the retrieved SIF values
plot = True # by default plot is True

# band determines which O2 band to use for retrieval
band = 'A' # by default uses 'A' for the O2A absorption band
```

Now run the full extraction from TIF to SIF on the defined inputs.


```python
get_tif_fluorescence(tif_pathname=tif_pathname, method=method, e_pathname=e_pathname,
                    bandnumber_pathname=bandnumber_pathname, plot=plot, band=band)
```

    Image Conversion Succesful!
    Converting CSV files
    Calculating Fluorescence using three FLD method



    
![png](/Users/jameswallace/Desktop/SIF_MISCADA_PROJECT/data_processing_scripts/example_extraction_workflow_images/output_9_1.png)
    



    
![png](/Users/jameswallace/Desktop/SIF_MISCADA_PROJECT/data_processing_scripts/example_extraction_workflow_images/output_9_2.png)
    


    Fluorescence values succesfully saved!


# Outputs

The get_tif_fluorescence function saves two files; one containing the retrieved fluorescence values at each co-ordinate and one containing the input parameters of the function.

The function also generates two plots. One showing the heatmap of the SIF values retrieved and a histogram showing the distribution of the SIF values retrieved.


```python
# the csv of the fluorescence values generated by the extraction method
fluor_df = pd.read_csv('/Users/jameswallace/Desktop/SIF_MISCADA_PROJECT/data_processing_scripts/fluorescence07_07_2021_15:39_.csv', index_col=0)
fluor_df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>fluor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>440230.254</td>
      <td>5810314.655</td>
      <td>13.087574</td>
    </tr>
    <tr>
      <th>1</th>
      <td>440231.254</td>
      <td>5810314.655</td>
      <td>14.540029</td>
    </tr>
    <tr>
      <th>2</th>
      <td>440230.254</td>
      <td>5810313.655</td>
      <td>13.991461</td>
    </tr>
    <tr>
      <th>3</th>
      <td>440231.254</td>
      <td>5810313.655</td>
      <td>14.752566</td>
    </tr>
    <tr>
      <th>4</th>
      <td>440232.254</td>
      <td>5810313.655</td>
      <td>15.837473</td>
    </tr>
  </tbody>
</table>
</div>




```python
# the text file containing the input parameters used within the extraction method
with open('/Users/jameswallace/Desktop/SIF_MISCADA_PROJECT/data_processing_scripts/fluorescence07_07_2021_15:39_parameters.txt') as f:
    lines = f.readlines()
    print(lines)
```

    ['{"tif_image": "/Users/jameswallace/Desktop/Project/data/red/s21_6562_E.tif", "method": "three", "e_spectra": "/Users/jameswallace/Desktop/SIF_MISCADA_PROJECT/py6s_generate_irradiance/17_06_2021_13:18_irradiance.csv", "Wavelengths": "/Users/jameswallace/Desktop/Project/band_number_conversion.csv"}']

